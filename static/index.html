<!DOCTYPE html>
<html>
<head>
    <title>Учет производства</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px;
            box-sizing: border-box;
        }
        button { 
            background: #4285f4; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .form-container {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #e6f7ee; color: #2e7d32; }
        .error { background: #ffebee; color: #c62828; }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Учет производства</h1>
        <div id="app">
            <div class="form-group">
                <label>Дата:</label>
                <input type="date" v-model="form.date">
            </div>
            
            <div class="form-group">
                <label>ФИО сотрудника:</label>
                <select v-model="form.fullName" required>
                    <option value="" disabled selected>Выберите сотрудника</option>
                    <option v-for="employee in employees" :value="employee">{{ employee }}</option>
                    <option value="Другой">Другой (указать)</option>
                </select>
                <input v-if="form.fullName === 'Другой'" 
                       v-model="customEmployee" 
                       placeholder="Введите ФИО" 
                       style="margin-top: 5px;">
            </div>
            
            <div class="form-group">
                <label>Название детали и операции:</label>
                <select v-model="form.partAndOperation" required>
                    <option value="" disabled selected>Выберите операцию</option>
                    <option v-for="operation in operations" :value="operation">{{ operation }}</option>
                    <option value="Другая">Другая (указать)</option>
                </select>
                <input v-if="form.partAndOperation === 'Другая'" 
                       v-model="customOperation" 
                       placeholder="Введите название операции" 
                       style="margin-top: 5px;">
            </div>
            
            <div class="form-group">
                <label>Количество деталей (общее):</label>
                <input type="number" v-model="form.totalParts" placeholder="10">
            </div>
            
            <div class="form-group">
                <label>Брак:</label>
                <input type="number" v-model="form.defective" placeholder="0">
            </div>
            
            <div class="form-group">
                <label>Примечания:</label>
                <textarea v-model="form.notes" rows="3" placeholder="Особенности работы..."></textarea>
            </div>
            
            <button @click="submit">Сохранить в таблицу</button>
            
            <div class="status-message" :class="{success: !isError, error: isError}" v-if="message">
                {{ message }}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                form: {
                    date: new Date().toISOString().substr(0, 10),
                    fullName: '',
                    partAndOperation: '',
                    totalParts: '',
                    defective: '',
                    notes: ''
                },
                employees: [
                    "Афанасьев",
                    "Бурлаков",
                    "Горемыкин",
                    "Маслов",
                    "Овсиенко",
                    "Серягин",
                    "Полушин",
                    "Отрадных",
                    "Соболев"
                ],
                operations: [
                    "Гайка Сибирь",
                    "Крышка Сибирь 1оп",
                    "Крышка Сибирь 2оп",
                    "Крышка Сибирь 3оп",
                    "Основание Сибирь 1-2оп",
                    "Сопло Сибирь",
                    "Трубка Сибирь",
                    "Втулка Сибирь (Алюм.)",
                    "Втулка Сибирь (Латунь)",
                    "Болт Зорька",
                    "Винт регулировочный М6",
                    "Винт регулировочный М8",
                    "Гайка МС",
                    "Крышка МС 1оп",
                    "Крышка МС 2оп",
                    "Крышка МС 3оп",
                    "Крышка МС 4оп",
                    "Основание МС 1оп",
                    "Основание МС 2оп",
                    "Основание МС 3-4оп",
                    "Сопло МС",
                    "Наконечник ДВИ",
                    "Закрутка Основание МС",
                    "Гайка МС доработка"
                ],
                customEmployee: '',
                customOperation: '',
                message: '',
                isError: false
            },
            methods: {
                async submit() {
                    // Подставляем кастомные значения если выбрано "Другой"
                    if (this.form.fullName === 'Другой' && this.customEmployee) {
                        this.form.fullName = this.customEmployee;
                    }
                    
                    if (this.form.partAndOperation === 'Другая' && this.customOperation) {
                        this.form.partAndOperation = this.customOperation;
                    }

                    // Валидация
                    if (!this.form.fullName || !this.form.partAndOperation) {
                        this.showMessage("ФИО и название операции обязательны!", true);
                        return;
                    }

                    try {
                        const response = await fetch('/submit', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.form)
                        });
                        
                        if (!response.ok) {
                            const error = await response.text();
                            throw new Error(error);
                        }
                        
                        this.showMessage("Данные успешно сохранены в Google Таблицу!");
                        this.clearForm();
                    } catch (err) {
                        this.showMessage("Ошибка: " + err.message, true);
                    }
                },
                clearForm() {
                    this.form = {
                        date: new Date().toISOString().substr(0, 10),
                        fullName: '',
                        partAndOperation: '',
                        totalParts: '',
                        defective: '',
                        notes: ''
                    };
                    this.customEmployee = '';
                    this.customOperation = '';
                },
                showMessage(msg, isErr = false) {
                    this.message = msg;
                    this.isError = isErr;
                    setTimeout(() => this.message = '', 5000);
                }
            }
        });
    </script>
</body>
</html>