<!DOCTYPE html>
<html>
<head>
    <title>Учет производства | Сибирь</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #4285f4;
            --accent-color: #e74c3c;
            --light-bg: #f5f7fa;
        }
        
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .form-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            font-size: 24px;
        }
        
        .form-switcher {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .form-switcher button {
            flex: 1;
            background: none;
            border: none;
            padding: 12px;
            cursor: pointer;
            font-weight: 500;
            color: var(--primary-color);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .form-switcher button.active {
            border-bottom: 3px solid var(--secondary-color);
            color: var(--secondary-color);
            background-color: rgba(66, 133, 244, 0.1);
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary-color);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
            outline: none;
        }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 15px;
        }
        
        button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        button:hover {
            background: #3367d6;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button svg {
            margin-right: 8px;
        }
        
        .status-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .status-content {
            max-width: 80%;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            font-size: 18px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
        }
        
        .status-success {
            background: #e6f7ee;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }
        
        .status-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        
        .custom-input {
            margin-top: 10px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logo svg {
            height: 60px;
            color: var(--primary-color);
        }

        /* Мобильная адаптация */
        @media (max-width: 768px) {
            .form-container {
                margin: 20px 15px;
                padding: 20px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .form-switcher button {
                padding: 10px;
                font-size: 14px;
            }
            
            input, textarea, select, button {
                padding: 10px 12px;
                font-size: 15px;
            }
            
            .logo svg {
                height: 50px;
            }
            
            .status-content {
                max-width: 90%;
                padding: 20px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .form-container {
                margin: 15px 10px;
                padding: 15px;
            }
            
            h1 {
                font-size: 18px;
                margin-bottom: 15px;
            }
            
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-switcher {
                flex-direction: column;
            }
            
            .form-switcher button {
                border-bottom: none;
                border-left: 3px solid transparent;
                text-align: left;
            }
            
            .form-switcher button.active {
                border-bottom: none;
                border-left: 3px solid var(--secondary-color);
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="form-container">
        <div class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
            </svg>
        </div>
        <h1>Учет производства</h1>
        
        <div class="form-switcher">
            <button @click="switchForm('production')" :class="{active: activeForm === 'production'}">Учет деталей</button>
            <button @click="switchForm('timesheet')" :class="{active: activeForm === 'timesheet'}">Табель работы</button>
        </div>
        
        <div id="app">
            <!-- Форма учета производства -->
            <div class="form-section" :class="{active: activeForm === 'production'}">
                <div class="form-group">
                    <label>Дата:</label>
                    <input type="date" v-model="productionForm.date" required>
                </div>
                
                <div class="form-group">
                    <label>ФИО сотрудника:</label>
                    <select v-model="productionForm.fullName" required>
                        <option value="" disabled selected>Выберите сотрудника</option>
                        <option v-for="employee in employees" :value="employee">{{ employee }}</option>
                        <option value="Другой">Другой (указать)</option>
                    </select>
                    <input v-if="productionForm.fullName === 'Другой'" 
                           v-model="customEmployee" 
                           placeholder="Введите ФИО" 
                           class="custom-input"
                           required>
                </div>
                
                <div class="form-group">
                    <label>Название детали и операции:</label>
                    <select v-model="productionForm.partAndOperation" required>
                        <option value="" disabled selected>Выберите операцию</option>
                        <option v-for="operation in operations" :value="operation">{{ operation }}</option>
                        <option value="Другая">Другая (указать)</option>
                    </select>
                    <input v-if="productionForm.partAndOperation === 'Другая'" 
                           v-model="customOperation" 
                           placeholder="Введите название операции" 
                           class="custom-input"
                           required>
                </div>
                
                <div class="form-group">
                    <label>Количество деталей (общее):</label>
                    <input type="number" v-model="productionForm.totalParts" placeholder="10" min="0" required>
                </div>
                
                <div class="form-group">
                    <label>Брак:</label>
                    <input type="number" v-model="productionForm.defective" placeholder="0" min="0">
                </div>
                
                <div class="form-group">
                    <label>Примечания:</label>
                    <textarea v-model="productionForm.notes" rows="3" placeholder="Особенности работы..."></textarea>
                </div>
                
                <button @click="submitProductionForm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                        <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    Сохранить в таблицу
                </button>
            </div>
            
            <!-- Форма табеля работы -->
            <div class="form-section" :class="{active: activeForm === 'timesheet'}">
                <div class="form-group">
                    <label>ФИО сотрудника:</label>
                    <select v-model="timesheetForm.fullName" required>
                        <option value="" disabled selected>Выберите сотрудника</option>
                        <option v-for="employee in employees" :value="employee">{{ employee }}</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Дата:</label>
                    <input type="date" v-model="timesheetForm.date" required>
                </div>
                
                <div class="form-group">
                    <label>Количество часов:</label>
                    <input type="number" v-model="timesheetForm.hours" min="0" max="24" step="0.5" placeholder="8" required>
                </div>
                
                <button @click="submitTimesheetForm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    Сохранить в табель
                </button>
            </div>
            
            <div class="status-overlay" v-if="message" @click="message = ''">
                <div class="status-content" :class="{'status-success': !isError, 'status-error': isError}">
                    {{ message }}
                    <div style="margin-top: 20px; font-size: 14px; color: #666;">
                        Кликните, чтобы закрыть
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                activeForm: 'production',
                productionForm: {
                    date: new Date().toISOString().substr(0, 10),
                    fullName: '',
                    partAndOperation: '',
                    totalParts: '',
                    defective: '',
                    notes: ''
                },
                timesheetForm: {
                    fullName: '',
                    date: new Date().toISOString().substr(0, 10),
                    hours: ''
                },
                employees: [
                    "Афанасьев",
                    "Бурлаков",
                    "Горемыкин",
                    "Маслов",
                    "Овсиенко",
                    "Серягин",
                    "Полушин",
                    "Отрадных",
                    "Соболев"
                ],
                operations: [
                    "Гайка Сибирь",
                    "Крышка Сибирь 1оп",
                    "Крышка Сибирь 2оп",
                    "Крышка Сибирь 3оп",
                    "Основание Сибирь 1-2оп",
                    "Сопло Сибирь",
                    "Трубка Сибирь",
                    "Втулка Сибирь (Алюм.)",
                    "Втулка Сибирь (Латунь)",
                    "Болт Зорька",
                    "Винт регулировочный М6",
                    "Винт регулировочный М8",
                    "Гайка МС",
                    "Крышка МС 1оп",
                    "Крышка МС 2оп",
                    "Крышка МС 3оп",
                    "Крышка МС 4оп",
                    "Основание МС 1оп",
                    "Основание МС 2оп",
                    "Основание МС 3-4оп",
                    "Сопло МС",
                    "Наконечник ДВИ",
                    "Закрутка Основание МС",
                    "Гайка МС доработка"
                ],
                customEmployee: '',
                customOperation: '',
                message: '',
                isError: false
            },
            methods: {
                switchForm(formType) {
                    this.activeForm = formType;
                    this.message = '';
                },
                
                async submitProductionForm() {
                    // Подставляем кастомные значения если выбрано "Другой"
                    if (this.productionForm.fullName === 'Другой') {
                        if (!this.customEmployee) {
                            this.showMessage("Введите ФИО сотрудника", true);
                            return;
                        }
                        this.productionForm.fullName = this.customEmployee;
                    }
                    
                    if (this.productionForm.partAndOperation === 'Другая') {
                        if (!this.customOperation) {
                            this.showMessage("Введите название операции", true);
                            return;
                        }
                        this.productionForm.partAndOperation = this.customOperation;
                    }

                    // Валидация
                    if (!this.productionForm.fullName || !this.productionForm.partAndOperation || !this.productionForm.totalParts) {
                        this.showMessage("Обязательные поля не заполнены!", true);
                        return;
                    }

                    try {
                        const response = await fetch('/submit-production', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.productionForm)
                        });
                        
                        if (!response.ok) {
                            const error = await response.text();
                            throw new Error(error);
                        }
                        
                        this.showMessage("Данные производства успешно сохранены!");
                        this.clearProductionForm();
                    } catch (err) {
                        this.showMessage("Ошибка: " + err.message, true);
                    }
                },
                
                async submitTimesheetForm() {
                    if (!this.timesheetForm.fullName || !this.timesheetForm.date || !this.timesheetForm.hours) {
                        this.showMessage("Все поля обязательны для заполнения!", true);
                        return;
                    }

                    try {
                        const response = await fetch('/submit-timesheet', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.timesheetForm)
                        });
                        
                        if (!response.ok) {
                            const error = await response.text();
                            throw new Error(error);
                        }
                        
                        this.showMessage("Данные табеля успешно сохранены!");
                        this.timesheetForm.hours = '';
                    } catch (err) {
                        this.showMessage("Ошибка: " + err.message, true);
                    }
                },
                
                clearProductionForm() {
                    this.productionForm = {
                        date: new Date().toISOString().substr(0, 10),
                        fullName: '',
                        partAndOperation: '',
                        totalParts: '',
                        defective: '',
                        notes: ''
                    };
                    this.customEmployee = '';
                    this.customOperation = '';
                },
                
                showMessage(msg, isErr = false) {
                    this.message = msg;
                    this.isError = isErr;
                    setTimeout(() => this.message = '', 5000);
                }
            }
        });
    </script>
</body>
</html>